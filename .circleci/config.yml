version: 2
jobs:
  test:
    docker:
      - image: circleci/buildpack-deps:18.04-browsers
    steps:
      - checkout
      - run: java -version
      - run: sudo apt-get update
      - run: sudo apt-get install libpango1.0-0
      - run: sudo apt-get install firefox
      - run: sudo ln -sf /usr/lib/firefox/firefox /usr/bin/firefox
      - run: sudo apt-get install maven

      - run: mvn test


      - run:
                name: install dependencies
                command: |
                    wget https://sonarsource.bintray.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-3.2.0.1227-linux.zip
                    unzip sonar-scanner-cli-3.2.0.1227-linux.zip
                    chmod +x ./sonar-scanner-3.2.0.1227-linux/bin/sonar-scanner
                    chmod +x ./sonar-scanner-3.2.0.1227-linux/jre/bin/java
                   
      - run:
                name: analyze with Sonar
                command: |
                                    ./sonar-scanner-3.2.0.1227-linux/bin/sonar-scanner -Dsonar.host.url=https://sonarcloud.io   
 	

      - store_artifacts:
                path: target/surefire-reports
                destination: tr1
                path: build/reports/tests
                destination: tr2

workflows:
  version: 2
  build_and_test:
    jobs:
      - test